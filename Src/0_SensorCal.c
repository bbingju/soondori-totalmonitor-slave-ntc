#include "0_SensorCal.h"



/*********************************************************************
*	 	pTableNTC
*		NTC 10KR 에 대한 환산용 테이블 
**********************************************************************/	
#ifndef __P_TABLE_NTC__
#define __P_TABLE_NTC__

uint32_t pTableNTC[161] = {
	3482, 3452, 3422, 3391, 3359, 3325, 3291, 3257, 3221, 3184, 	// -10 ~	-1 [째C]
	3146, 														//	 0
	3108, 3069, 3028, 2987, 2947, 2903, 2861, 2818, 2775, 2732, 	//	 1 ~	10
	2686, 2640, 2595, 2549, 2506, 2457, 2412, 2367, 2321, 2276, 	//	11 ~	20
	2230, 2184, 2139, 2093, 2048, 2002, 1957, 1912, 1868, 1827, 	//	21 ~	30
	1781, 1738, 1696, 1655, 1617, 1574, 1535, 1496, 1458, 1422, 	//	31 ~	40
	1383, 1346, 1311, 1276, 1245, 1208, 1176, 1145, 1115, 1085, 	//	41 ~	50
	1055, 1027,  998,  971,  943,  918,  892,  867,  843,  818, 	//	51 ~	60
	 796,  773,  751,  730,  709,  689,  670,  651,  632,  614, 	//	61 ~	70
	 597,  580,  564,  548,  532,  518,  503,  489,  475,  462, 	//	71 ~	80
	 449,  437,  425,  413,  401,  390,  380,  369,  359,  349, 	//	81 ~	90
	 340,  331,  322,  313,  304,  296,  288,  281,  273,  266, 	//	91 ~ 100
	 259,  252,  246,  239,  233,  227,  221,  216,  210,  204, 	// 101 ~ 110
	 199,  194,  189,  185,  180,  176,  171,  167,  163,  159, 	// 111 ~ 120
	 155,  151,  148,  144,  141,  137,  134,  131,  128,  125, 	// 121 ~ 130
	 122,  119,  116,  114,  111,  108,  106,  104,  101, 	99, 	// 131 ~ 140
		97, 	95, 	92, 	90, 	88, 	86, 	85, 	83, 	81, 	79		// 141 ~ 150
};
#endif

/*********************************************************************
*	 	pTableRTD
*		RTD PT100 에 대한 환산용 테이블 
**********************************************************************/	
#ifndef __P_TABLE_RTD__
#define __P_TABLE_RTD__

uint32_t pTableRTD[161] = {
	1745, 1752, 1758, 1764, 1770, 1777, 1783, 1790, 1796, 1802, 	// -10 ~	-1 [째C]
	1808, 																
	1815, 1821, 1827, 1833, 1840, 1846, 1852, 1858, 1865, 1871, 	//	 1 ~	10
	1877, 1883, 1890, 1896, 1902, 1908, 1914, 1920, 1926, 1933, 	//	11 ~	20
	1939, 1945, 1951, 1957, 1963, 1969, 1976, 1982, 1988, 1994, 	//	21 ~	30
	2000, 2006, 2012, 2018, 2024, 2030, 2036, 2042, 2048, 2054, 	//	31 ~	40
	2060, 2066, 2072, 2078, 2084, 2090, 2096, 2102, 2108, 2114, 	//	41 ~	50
	2120, 2126, 2132, 2138, 2143, 2149, 2155, 2161, 2167, 2173, 	//	51 ~	60
	2179, 2185, 2190, 2196, 2202, 2208, 2214, 2220, 2225, 2231, 	//	61 ~	70
	2237, 2243, 2249, 2254, 2260, 2266, 2272, 2278, 2283, 2289, 	//	71 ~	80
	2295, 2301, 2306, 2312, 2318, 2323, 2329, 2335, 2340, 2346, 	//	81 ~	90
	2352, 2357, 2363, 2369, 2374, 2380, 2386, 2391, 2397, 2403, 	//	91 ~ 100
	2408, 2414, 2419, 2425, 2430, 2436, 2442, 2447, 2453, 2458, 	// 101 ~ 110
	2464, 2469, 2475, 2481, 2486, 2492, 2497, 2503, 2508, 2514, 	// 111 ~ 120
	2519, 2524, 2530, 2536, 2541, 2546, 2552, 2557, 2563, 2568, 	// 121 ~ 130
	2574, 2579, 2584, 2590, 2595, 2601, 2606, 2611, 2617, 2622, 	// 131 ~ 140
	2628, 2633, 2638, 2644, 2649, 2654, 2660, 2665, 2670, 2676		// 141 ~ 150
};

#endif


/*********************************************************************
*	 	Calc_BD_Temp
*		ETH-01DV 온도 변환 함수 
* 	val : ADC 값을 입력 
**********************************************************************/
float Calc_BD_Temp(uint32_t val)
{
	return (float)val * 165 / 4096 - 40;		// 째C = Vout[12bit=4096] / (Vin=5[V] / 165) - 40
}

/*********************************************************************
*	 	Calc_BD_Humi
*		ETH-01DV 습도 변환 함수 
* 	val : ADC 값을 입력 
**********************************************************************/
float Calc_BD_Humi(uint32_t val)
{
//			return (double)val * 100 / 4096;			// %RH = Vout[12bit=4096] / (Vin=5[V] / 100)
	return (float)val * 125 / 4096 - 12.5;
}

/*********************************************************************
*	 	Calc_Temp_NTC
*		NTC 온도 변환 함수 
* 	val : ADC 값을 입력, TABLE 중간 값을 보간하여 표시 
**********************************************************************/
float Calc_Temp_NTC(uint32_t val)
{
	int i;

	if ((val == 0) || (val > pTableNTC[0]) || (val < pTableNTC[160])){
		return 0;

	}

	for (i = 0; i < 161; i++){
		if (pTableNTC[i] < val){
			break;
		}
	}
	
	if (i == 0){
		return 0;
	}
	
	float dv = (float) val;
	float d1 = (float) pTableNTC[i - 1];
	float d2 = (float) pTableNTC[i];
	
	return (dv - d1) / (d2 - d1) + i - 11;
}

/*********************************************************************
*	 	Calc_Temp_RTD
*		RTC 온도 변환 함수 
* 	val : ADC 값을 입력, TABLE 중간 값을 보간하여 표시 
**********************************************************************/
float Calc_Temp_RTD(uint32_t val)
{
	float dv;
	float d1;
	float d2;
    float res = 0;
	int i;
	
	if ((val == 0) || (val < pTableRTD[0]) || (val > pTableRTD[160])){
		return 0;
	}
	
	for (i = 0; i < 161; i++)	{
		if (pTableRTD[i] > val){
			break;
		}
	}
	
	if (i == 0){
		return 0;
	}
	
	dv = (float)val;
	d1 = (float)pTableRTD[i - 1];
	d2 = (float)pTableRTD[i];
	
	res = (dv - d1) / (d2 - d1) + i - 11;
    return res;
}
